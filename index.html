<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Productivity Suite</title>
  <style>
    :root{--bg:#0b1223;--card:#0f172a;--elev:#111827;--muted:#94a3b8;--text:#e5e7eb;--brand:#60a5fa;--ok:#22c55e;--warn:#f59e0b;--danger:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans';background:linear-gradient(120deg,#0b1223,#0a0f1b);color:var(--text)}
    header{position:sticky;top:0;z-index:50;display:flex;gap:12px;align-items:center;padding:14px 18px;border-bottom:1px solid #1f2937;background:#0b1223}
    header h1{font-size:18px;margin:0}
    .tag{font-size:12px;color:var(--muted);border:1px solid #243244;padding:2px 8px;border-radius:12px}
    nav{display:flex;flex-wrap:wrap;gap:8px;margin-left:auto}
    .tab{padding:8px 12px;border:1px solid #243244;border-radius:10px;background:#0e162b;color:#cbd5e1;cursor:pointer}
    .tab.active{border-color:#3b82f6;background:#0b1223;color:#e5e7eb}

    .container{max-width:1200px;margin:20px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    @media (max-width:1000px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:14px}
    .card h2{margin:0 0 10px 0;font-size:18px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center}
    .btn{padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#132035;color:#e5e7eb;cursor:pointer}
    .btn.primary{border-color:#1d4ed8;background:linear-gradient(180deg,#3b82f6,#1e40af)}
    .btn.ok{border-color:#065f46;background:linear-gradient(180deg,#16a34a,#15803d)}
    .btn.danger{border-color:#7f1d1d;background:linear-gradient(180deg,#ef4444,#b91c1c)}
    input[type="text"],input[type="datetime-local"],textarea,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0e162b;color:#e5e7eb}
    textarea{min-height:90px}
    ul.clean{list-style:none;padding:0;margin:0}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid #243244;background:#0e162b}

    /* Chat */
    #chatbox{height:420px;overflow:auto;padding:8px;background:#0b1326;border:1px solid #1f2937;border-radius:12px}
    .bubble{max-width:720px;padding:10px 12px;border-radius:14px;margin:6px 0;line-height:1.4;white-space:pre-wrap}
    .bubble.bot{background:#0f172a;border:1px solid #1f2937}
    .bubble.user{background:#13212f;border:1px solid #1e293b;align-self:flex-end}

    /* Tasks */
    .task{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid #1f2937;border-radius:12px;margin-bottom:8px}
    .task.done{opacity:.7;text-decoration:line-through}

    /* Calendar */
    .calendar{display:grid;grid-template-rows:auto 1fr;gap:10px}
    .cal-header{display:flex;justify-content:space-between;align-items:center}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .dow{font-size:12px;color:var(--muted);text-align:center}
    .day{min-height:110px;background:#0e162b;border:1px solid #1f2937;border-radius:10px;padding:6px;display:flex;flex-direction:column}
    .day .num{font-size:12px;color:#9ca3af;margin-bottom:6px}
    .day.today{outline:1px dashed #3b82f6}
    .event{font-size:12px;margin:4px 0;padding:6px;border-radius:8px;border:1px solid #1f2937;background:#122036}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px}
    .modal .dialog{background:#0f172a;border:1px solid #1f2937;border-radius:16px;max-width:520px;width:100%;padding:16px}

    .footer{text-align:center;color:var(--muted);font-size:12px;margin:20px 0}
  </style>
</head>
<body>
  <header>
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3C7.03 3 3 7.03 3 12s4.03 9 9 9c1.93 0 3.71-.61 5.17-1.65L21 21l-1.65-3.83A8.957 8.957 0 0 0 21 12c0-4.97-4.03-9-9-9Z" stroke="#93c5fd" stroke-width="1.5"/><path d="M8 12h8M12 8v8" stroke="#93c5fd" stroke-width="1.5" stroke-linecap="round"/></svg>
    <h1>Student Productivity Suite</h1>
    <span class="tag">Offline · LocalStorage</span>
    <nav id="nav"></nav>
  </header>

  <div class="container" id="app"></div>
  
  <!-- Event Modal -->
  <div class="modal" id="eventModal">
    <div class="dialog">
      <h3 style="margin:0 0 8px 0">Add / Edit Event</h3>
      <div class="row" style="margin-bottom:8px">
        <input id="evTitle" type="text" placeholder="Event title (e.g., Chemistry exam)" />
      </div>
      <div class="row" style="margin-bottom:8px">
        <input id="evStart" type="datetime-local" />
      </div>
      <div class="row" style="margin-bottom:8px">
        <input id="evEnd" type="datetime-local" />
      </div>
      <div class="row" style="margin-bottom:8px">
        <textarea id="evDesc" placeholder="Notes / description (optional)"></textarea>
      </div>
      <div class="row" style="justify-content:space-between">
        <button class="btn danger" id="evDelete" style="display:none">Delete</button>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn" onclick="closeEventModal()">Cancel</button>
          <button class="btn ok" id="evSave">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">Built for students • Works offline • No sign-in required</div>

  <script>
    // ===== Storage helpers =====
    const store = { get:k=>{ try{return JSON.parse(localStorage.getItem(k))}catch{return null} }, set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };
    const KEYS = { TASKS:'sps_tasks_v1', NOTES:'sps_notes_v1', EVENTS:'sps_events_v1' };

    // ===== State =====
    let tasks = store.get(KEYS.TASKS) || []; // {id,text,dueISO,done}
    let notes = store.get(KEYS.NOTES) || []; // {id,text,createdISO}
    let events = store.get(KEYS.EVENTS) || []; // {id,title,startISO,endISO,desc}

    // ===== Utils =====
    const uid = ()=> Math.random().toString(36).slice(2,9);
    const fmtDT = (iso)=> iso? new Date(iso).toLocaleString(): '';
    const todayISO = ()=> new Date().toISOString();

    // ===== Simple Router (tabs) =====
    const routes = [
      { id:'home', label:'Home' },
      { id:'todo', label:'To‑Do' },
      { id:'calendar', label:'Calendar' },
      { id:'notes', label:'Notes' },
      { id:'timer', label:'Pomodoro' },
      { id:'chat', label:'Chatbot' },
    ];
    let currentRoute = 'home';

    function renderNav(){
      const nav = document.getElementById('nav');
      nav.innerHTML = '';
      routes.forEach(r=>{
        const b = document.createElement('button');
        b.className = 'tab' + (r.id===currentRoute? ' active':'');
        b.textContent = r.label;
        b.onclick = ()=>{ currentRoute = r.id; render(); };
        nav.appendChild(b);
      });
    }

    function render(){
      renderNav();
      const app = document.getElementById('app');
      app.innerHTML='';
      if(currentRoute==='home') return viewHome(app);
      if(currentRoute==='todo') return viewTodo(app);
      if(currentRoute==='calendar') return viewCalendar(app);
      if(currentRoute==='notes') return viewNotes(app);
      if(currentRoute==='timer') return viewTimer(app);
      if(currentRoute==='chat') return viewChat(app);
    }

    // ===== Views =====
    function viewHome(app){
      const grid = div('grid');
      const left = card(); left.appendChild(h2('Welcome 👋'));
      left.appendChild(p(`This is your all‑in‑one productivity hub. Use the tabs to manage tasks, plan events on a calendar, write notes, focus with a Pomodoro timer, or use the chatbot for quick commands.`));
      left.appendChild(p('Quick tips:'));
      left.appendChild(ul([
        'Add a task: go to To‑Do, or in Chatbot type: add task: finish biology due 2025-09-05 17:00',
        'Add an event: open Calendar and click a date, or in Chatbot: add event: Chem exam on 2025-09-10 10:00',
        'Start Pomodoro: in Timer tab, or in Chatbot: start pomodoro 50/10 x2',
      ]));

      const right = card(); right.appendChild(h2('Today'));
      const todayTasks = tasks.filter(t=>!t.done && t.dueISO && sameDay(new Date(t.dueISO), new Date()));
      if(todayTasks.length===0) right.appendChild(p('No tasks due today. 🎯'));
      else todayTasks.forEach(t=> right.appendChild(row([span('• '+t.text), small('Due '+fmtDT(t.dueISO))])));

      grid.appendChild(left); grid.appendChild(right); app.appendChild(grid);
    }

    // To‑Do view
    function viewTodo(app){
      const c = card(); c.appendChild(h2('To‑Do List'));
      const form = div('row');
      const txt = input('text','New task (e.g., "Complete lab report")');
      const due = input('datetime-local');
      due.title = 'Optional due date/time';
      const addBtn = button('Add', 'btn ok');
      addBtn.onclick = ()=>{
        const t = { id:uid(), text:txt.value.trim(), dueISO: due.value? new Date(due.value).toISOString(): null, done:false };
        if(!t.text) return;
        tasks.push(t); persist('tasks'); txt.value=''; due.value=''; render();
      };
      form.append(txt,due,addBtn); c.appendChild(form);

      const list = div();
      sortTasks(tasks).forEach((t,i)=> list.appendChild(taskItem(t)) );
      c.appendChild(list); app.appendChild(c);
    }

    function taskItem(t){
      const li = div('task'+(t.done?' done':''));
      const left = div(); left.appendChild(strong(t.text)); left.appendChild(p(t.dueISO? 'Due: '+fmtDT(t.dueISO): '', 'muted'));
      const controls = div('row');
      const doneBtn = button('✔','btn'); doneBtn.title='Mark done'; doneBtn.onclick=()=>{ t.done=true; persist('tasks'); render(); };
      const delBtn = button('✖','btn'); delBtn.title='Delete'; delBtn.onclick=()=>{ tasks = tasks.filter(x=>x.id!==t.id); persist('tasks'); render(); };
      controls.append(doneBtn,delBtn);
      li.append(left,controls);
      return li;
    }

    function sortTasks(arr){
      return arr.slice().sort((a,b)=>{
        const ad=a.dueISO? new Date(a.dueISO).getTime(): Infinity;
        const bd=b.dueISO? new Date(b.dueISO).getTime(): Infinity;
        if(ad===bd) return a.text.localeCompare(b.text);
        return ad-bd;
      })
    }

    // Calendar view
    let calCursor = new Date();
    function viewCalendar(app){
      const c = card(); c.appendChild(h2('Calendar & Event Planner'));
      const cal = div('calendar');
      const header = div('cal-header');
      const prev = button('← Prev','btn'); prev.onclick=()=>{ calCursor = addMonths(calCursor,-1); render(); };
      const next = button('Next →','btn'); next.onclick=()=>{ calCursor = addMonths(calCursor,1); render(); };
      const label = h3(monthLabel(calCursor));
      header.append(prev,label,next);
      cal.appendChild(header);
      const grid = div('cal-grid');
      // DOW header
      ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{ const s = div('dow'); s.textContent=d; grid.appendChild(s) });
      const first = new Date(calCursor.getFullYear(), calCursor.getMonth(), 1);
      const startIdx = first.getDay();
      const daysInMonth = new Date(calCursor.getFullYear(), calCursor.getMonth()+1, 0).getDate();
      // Empty cells
      for(let i=0;i<startIdx;i++){ grid.appendChild(div()); }
      // Day cells
      for(let d=1; d<=daysInMonth; d++){
        const cell = div('day');
        const dateObj = new Date(calCursor.getFullYear(), calCursor.getMonth(), d);
        const isoDate = dateObj.toISOString();
        const num = div('num'); num.textContent = d; cell.appendChild(num);
        if(sameDay(dateObj, new Date())) cell.classList.add('today');
        cell.onclick = ()=> openEventModal({ startISO: isoNoTZ(dateObj) });

        // Render events on this day
        events.filter(e=> sameDay(new Date(e.startISO), dateObj)).forEach(e=>{
          const pill = div('event'); pill.textContent = timeLabel(e.startISO)+' '+e.title; pill.title = e.desc || '';
          pill.onclick = (ev)=>{ ev.stopPropagation(); openEventModal(e); };
          cell.appendChild(pill);
        })
        grid.appendChild(cell);
      }
      cal.appendChild(grid);

      // Upcoming list
      const upcoming = events.slice().sort((a,b)=> new Date(a.startISO)-new Date(b.startISO)).filter(e=> new Date(e.startISO)>= startOfDay(new Date()));
      const side = card(); side.appendChild(h2('Upcoming'));
      if(upcoming.length===0) side.appendChild(p('No upcoming events.'));
      else upcoming.slice(0,10).forEach(e=> side.appendChild(row([span('• '+e.title), small(fmtDT(e.startISO))])));

      const layout = div('grid'); layout.appendChild(c); layout.appendChild(side); app.appendChild(layout);
      c.appendChild(cal);
    }

    // Notes view
    function viewNotes(app){
      const c = card(); c.appendChild(h2('Notes'));
      const form = div('row');
      const area = document.createElement('textarea'); area.placeholder='Write a quick note (e.g., exam topics, links, reminders)';
      const save = button('Save Note','btn ok');
      save.onclick=()=>{ const t=area.value.trim(); if(!t) return; notes.push({id:uid(),text:t,createdISO:todayISO()}); area.value=''; persist('notes'); render(); };
      form.append(area, save); c.appendChild(form);

      const list = ulClean();
      notes.slice().reverse().forEach(n=>{
        const item = div('task');
        const left = div(); left.appendChild(strong(n.text)); left.appendChild(p(new Date(n.createdISO).toLocaleString(),'muted'));
        const del = button('✖','btn'); del.onclick=()=>{ notes=notes.filter(x=>x.id!==n.id); persist('notes'); render(); };
        item.append(left, del); list.appendChild(item);
      });
      c.appendChild(list); app.appendChild(c);
    }

    // Pomodoro view
    let pomoTimer=null; let pomoState='idle'; let remaining=0; let workM=25, breakM=5, cycles=4, cycleN=1;
    function viewTimer(app){
      const c = card(); c.appendChild(h2('Pomodoro Timer'));
      const controls = div('row');
      const work = input('number'); work.value=workM; work.min=1; work.title='Work minutes';
      const brk = input('number'); brk.value=breakM; brk.min=1; brk.title='Break minutes';
      const cyc = input('number'); cyc.value=cycles; cyc.min=1; cyc.title='Cycles';
      const startBtn = button('Start','btn ok'); const stopBtn = button('Stop','btn danger');
      const label = h3('Ready');
      startBtn.onclick=()=>{ workM=+work.value||25; breakM=+brk.value||5; cycles=+cyc.value||4; startPomodoro(); update(); };
      stopBtn.onclick=()=> stopPomodoro();
      controls.append(pill('Work'), work, pill('Break'), brk, pill('Cycles'), cyc, startBtn, stopBtn);
      const big = h1('00:00'); big.style.textAlign='center'; big.style.margin='16px 0 0 0';
      c.append(label, big, controls); app.appendChild(c);

      function update(){
        if(pomoState==='idle') { label.textContent='Ready'; big.textContent='00:00'; return }
        const m = Math.floor(remaining/60), s = remaining%60; big.textContent=`${pad(m)}:${pad(s)}`;
        label.textContent = `${pomoState==='work'?'Focus':'Break'} • Cycle ${cycleN}/${cycles}`;
      }
      function tick(){ remaining--; if(remaining<=0){
        if(pomoState==='work'){ notify('✅ Work block complete. Break time!'); pomoState='break'; remaining=breakM*60 }
        else { notify('🔔 Break over. Back to focus!'); pomoState='work'; cycleN++; if(cycleN>cycles){ stopPomodoro(); notify('🎉 Pomodoro session complete!'); return } remaining=workM*60 }
      } update(); }
      function startPomodoro(){ clearInterval(pomoTimer); pomoState='work'; remaining=workM*60; cycleN=1; pomoTimer=setInterval(()=>{ tick(); },1000) }
      function stopPomodoro(){ clearInterval(pomoTimer); pomoTimer=null; pomoState='idle'; update(); }
      window.stopPomodoro = stopPomodoro; // for chat
      update();
    }

    // Chat view
    function viewChat(app){
      const c = card(); c.appendChild(h2('Chatbot'));
      const box = div(); box.id='chatbox'; c.appendChild(box);
      const roww = div('row');
      const inputEl = input('text','Type a message (try: help)');
      const send = button('Send','btn primary');
      const mic = button('🎙️','btn'); mic.title='Voice input';
      roww.append(inputEl, send, mic); c.appendChild(roww);
      app.appendChild(c);

      function push(text, who='bot'){ const b=div('bubble '+who); b.textContent=text; box.appendChild(b); box.scrollTop=box.scrollHeight }

      function router(s){
        const msg = s.trim(); if(!msg) return;
        // help
        if(/^help$|^commands?$/i.test(msg))
          return push(`Commands:\n\n• add task: <text> [due YYYY-MM-DD HH:MM]\n• list tasks\n• done <#>   · delete <#>\n• add event: <title> on YYYY-MM-DD HH:MM [to HH:MM]\n• list events\n• start pomodoro [25/5 x4]   · stop timer\n• note: <text>   · show notes   · clear notes\n• motivate me / quote`);

        // tasks
        let m = msg.match(/^add\s+task[:\-\s]+(.+)$/i);
        if(m){ const payload=m[1]; const due=payload.match(/\bdue\s+([0-9]{4}-[0-9]{2}-[0-9]{2})(?:\s+([0-9]{2}:[0-9]{2}))?/i); let text=payload, dueISO=null; if(due){ const date=due[1], time=due[2]||'23:59'; const dt=new Date(`${date}T${time}:00`); if(!isNaN(dt)) dueISO=dt.toISOString(); text=payload.replace(due[0],'').trim(); }
          const t={id:uid(),text, dueISO, done:false}; tasks.push(t); persist('tasks'); push(`✅ Task added${dueISO? ' · due '+fmtDT(dueISO):''}:\n• ${text}`); return }
        if(/^list\s+tasks$|^tasks$/i.test(msg)){ if(tasks.length===0) return push('No tasks yet.'); return push(sortTasks(tasks).map((t,i)=>`${i+1}. ${t.text}${t.dueISO?' (due '+fmtDT(t.dueISO)+')':''}${t.done?' ✔':''}`).join('\n')) }
        m = msg.match(/^done\s+(\d+)$/i); if(m){ const i=+m[1]-1; if(tasks[i]){ tasks[i].done=true; persist('tasks'); push('✔ Marked done: '+tasks[i].text);} else push('Task number not found.'); return }
        m = msg.match(/^(del|delete|remove)\s+(\d+)$/i); if(m){ const i=+m[2]-1; if(tasks[i]){ const name=tasks[i].text; tasks.splice(i,1); persist('tasks'); push('🗑️ Deleted task: '+name);} else push('Task number not found.'); return }

        // events
        m = msg.match(/^add\s+event[:\-\s]+(.+)$/i);
        if(m){ const payload=m[1]; const when = payload.match(/\bon\s+([0-9]{4}-[0-9]{2}-[0-9]{2})\s+([0-9]{2}:[0-9]{2})(?:\s*(?:to|-)\s*([0-9]{2}:[0-9]{2}))?/i); let title=payload; let startISO=null, endISO=null; if(when){ const d=when[1], t1=when[2], t2=when[3]; const s=new Date(`${d}T${t1}:00`); if(!isNaN(s)) startISO=s.toISOString(); if(t2){ const e=new Date(`${d}T${t2}:00`); if(!isNaN(e)) endISO=e.toISOString(); } title = payload.replace(when[0],'').replace(/^on\s*/i,'').trim(); }
          const ev={id:uid(), title: title||'Untitled', startISO: startISO||todayISO(), endISO, desc:''}; events.push(ev); persist('events'); push('📅 Event added: '+ev.title+' @ '+fmtDT(ev.startISO)); return }
        if(/^list\s+events$|^events$/i.test(msg)){ if(events.length===0) return push('No events yet.'); const out = events.slice().sort((a,b)=>new Date(a.startISO)-new Date(b.startISO)).map((e,i)=>`${i+1}. ${e.title} (${fmtDT(e.startISO)})`).join('\n'); return push(out) }

        // pomodoro
        if(/^start\s+pomodoro(.*)$/i.test(msg)){ const arg=msg.replace(/^start\s+pomodoro/i,'').trim(); let w=25,b=5,c=4; const mm=arg.match(/(\d+)\/(\d+)\s*x(\d+)/i); if(mm){ w=+mm[1]; b=+mm[2]; c=+mm[3]; }
          workM=w; breakM=b; cycles=c; currentRoute='timer'; render(); notify(`⏱️ Pomodoro started: ${w}/${b} × ${c}`); return }
        if(/^stop(\s+timer|\s+pomodoro)?$/i.test(msg)){ if(typeof window.stopPomodoro==='function') window.stopPomodoro(); push('⏹️ Timer stopped.'); return }

        // notes
        m = msg.match(/^note[:\-\s]+(.+)/i); if(m){ notes.push({id:uid(), text:m[1].trim(), createdISO:todayISO()}); persist('notes'); push('🗒️ Saved note.'); return }
        if(/^show\s+notes$|^notes$/i.test(msg)){ if(notes.length===0) return push('No notes yet.'); return push(notes.slice().reverse().map((n,i)=>`${i+1}. ${n.text} (${new Date(n.createdISO).toLocaleString()})`).join('\n')) }
        if(/^clear\s+notes$/i.test(msg)){ notes=[]; persist('notes'); push('🧹 Cleared all notes.'); return }

        // quotes
        if(/^motivate\s*me$|^quote$/i.test(msg)){ const q = QUOTES[Math.floor(Math.random()*QUOTES.length)]; return push('💡 '+q) }

        return push("Sorry, I didn't catch that. Type 'help' to see commands.");
      }

      const QUOTES=[
        'Small progress is still progress.',
        'Focus on being productive instead of busy. – Tim Ferriss',
        'The secret of getting ahead is getting started. – Mark Twain',
        'Discipline is choosing what you want most over what you want now.',
        'It always seems impossible until it’s done. – Nelson Mandela',
      ];

      // events
      send.onclick = ()=>{ const v=inputEl.value.trim(); if(!v) return; push(v,'user'); inputEl.value=''; router(v); };
      inputEl.addEventListener('keydown',e=>{ if(e.key==='Enter'){ send.click() } });
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition; mic.onclick=()=>{ if(!SR) return push('🎙️ Voice input not supported on this browser.'); const r=new SR(); r.lang='en-US'; r.onresult=(e)=>{ const t=e.results[0][0].transcript; push(t,'user'); router(t) }; r.start(); };
      push('👋 Hi! Type "help" to see what I can do.');
    }

    // ===== Calendar modal =====
    let editingEventId=null;
    function openEventModal(ev){ editingEventId = ev.id || null; document.getElementById('eventModal').style.display='flex';
      const t=document.getElementById('evTitle'), s=document.getElementById('evStart'), e=document.getElementById('evEnd'), d=document.getElementById('evDesc'), del=document.getElementById('evDelete');
      t.value = ev.title || '';
      s.value = toLocalInput(ev.startISO || todayISO());
      e.value = toLocalInput(ev.endISO || '');
      d.value = ev.desc || '';
      del.style.display = editingEventId? 'inline-block':'none';
      del.onclick = ()=>{ events = events.filter(x=>x.id!==editingEventId); persist('events'); closeEventModal(); render(); };
      document.getElementById('evSave').onclick = ()=>{
        const rec = { id: editingEventId || uid(), title: t.value.trim()||'Untitled', startISO: new Date(s.value).toISOString(), endISO: e.value? new Date(e.value).toISOString(): null, desc: d.value.trim() };
        if(editingEventId){ const idx = events.findIndex(x=>x.id===editingEventId); if(idx>-1) events[idx]=rec; } else events.push(rec);
        persist('events'); closeEventModal(); render();
      }
    }
    function closeEventModal(){ document.getElementById('eventModal').style.display='none'; editingEventId=null; }

    // ===== Notifications =====
    async function notify(message){ try{ if('Notification' in window){ if(Notification.permission==='granted') new Notification('📚 Study Suite', { body:message }); else if(Notification.permission!=='denied'){ const p=await Notification.requestPermission(); if(p==='granted') new Notification('📚 Study Suite', { body:message }); } } }catch{} console.log('[notify]', message) }

    // ===== Helpers: DOM =====
    const div = (cls='')=>{ const d=document.createElement('div'); if(cls) d.className=cls; return d };
    const h1=t=>{ const e=document.createElement('h1'); e.textContent=t; return e };
    const h2=t=>{ const e=document.createElement('h2'); e.textContent=t; return e };
    const h3=t=>{ const e=document.createElement('h3'); e.textContent=t; return e };
    const p=(t,cls='')=>{ const e=document.createElement('p'); e.textContent=t; if(cls) e.className=cls; return e };
    const strong=t=>{ const e=document.createElement('strong'); e.textContent=t; return e };
    const small=t=>{ const e=document.createElement('span'); e.textContent=t; e.className='muted'; e.style.marginLeft='8px'; return e };
    const span=t=>{ const e=document.createElement('span'); e.textContent=t; return e };
    const button=(t,cls='btn')=>{ const b=document.createElement('button'); b.textContent=t; b.className=cls; return b };
    const pill=t=>{ const e=document.createElement('span'); e.className='pill'; e.textContent=t; return e };
    const input=(type,ph='')=>{ const i=document.createElement('input'); i.type=type; if(ph) i.placeholder=ph; return i };
    const ul = (items)=>{ const u=document.createElement('ul'); items.forEach(x=>{ const li=document.createElement('li'); li.textContent=x; u.appendChild(li) }); return u };
    const ulClean = ()=> document.createElement('ul');
    const card=()=> div('card');

    // ===== Date helpers =====
    const monthLabel = (d)=> d.toLocaleString(undefined,{month:'long',year:'numeric'});
    const addMonths = (d, n)=> new Date(d.getFullYear(), d.getMonth()+n, 1);
    const sameDay = (a,b)=> a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
    const startOfDay = (d)=> new Date(d.getFullYear(), d.getMonth(), d.getDate());
    const timeLabel = (iso)=> new Date(iso).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const toLocalInput = (iso)=>{ if(!iso) return ''; const d=new Date(iso); const pad=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}` };
    const isoNoTZ = (d)=> new Date(d.getFullYear(), d.getMonth(), d.getDate(), 9, 0, 0).toISOString();
    const pad = n=> String(n).padStart(2,'0');

    // ===== Persistence =====
    function persist(which){
      if(which==='tasks') store.set(KEYS.TASKS, tasks);
      if(which==='notes') store.set(KEYS.NOTES, notes);
      if(which==='events') store.set(KEYS.EVENTS, events);
    }

    // ===== Boot =====
    render();
  </script>
</body>
</html>
npm install -g firebase-tools